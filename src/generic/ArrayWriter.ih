

namespace kiwi
{
namespace generic
{




template<typename T, unsigned int D>
ArrayWriter<T,D>::ArrayWriter(
	const core::Resource::WriterInputPort& port
)
{
	ArrayContainer<T,D>* resource = 
		dynamic_cast< ArrayContainer<T,D>* >( 
			port.connectedOutput()->resource() 
		);
	if(!resource)
	{
		debug.error() << "ArrayContainerWriter<"
			<<types::str<T>() 
			<< ">::Constructor : "
			<< "enable to determine the Resource type" 
			<< endl();
	}
	_port = port.connectedOutput()->index();
	_data = resource->getDataPointer(_port);
	_incs = resource->increments(_port);
	_span = resource->spanSize();
}



template<typename T, unsigned int D>
T ArrayWriter<T,D>::get(const Point<int,D>& coords) const
{
	unsigned index = 0;
	for(unsigned i = 0; i < D; ++i)
		index += _incs(i)*coords(i);
		
	return _data[index];
}
template<typename T, unsigned int D>
void ArrayWriter<T,D>::set(const Point<int, D>& coords, ValueType value)
{
	unsigned index = 0;
	for(unsigned i = 0; i < D; ++i)
		index += _incs(i)*coords(i);
		
	_data[index] = value;
}

} // namespace
} // namespace
